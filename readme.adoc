# PyCam

A python control-software for a raspberry pi with a camera, posting images. The software can also control a light (led-strip etc) and a status-indicator. 

It was primarily intended for collecting image-data for research or machine-learning projects but could ofcourse be used in other applications as well.

The software should work with all raspberry pi's but depending on computational power some features now or in the future might not work with all raspberry pi models.

Current supported camera-types has an implementation in the PyCam/Cam -module and it is fairly easy to add new camera-types here if needed. 

There are a lot of different settings, checkout camconfig.py.


## General

The project uses python3, libcamera and picamera2 among some other packages.

## Currently implemented features

* Support for Raspberry Pi Camera module 3
* Fully configurable from a config file
* Logging to server with http to a configurable url
* Logging to file in the pi
* Saving still-images and meta-data at a configuarble interval and send this to a configurable url for saving in backend
* Configurable image resolution 
* Configurable log-level
* Control a led-strip or other light-source with PWM (req. a MOS-FET or some other type of PWM switch)
* Control a addressable RGB LED for status indication (WS2811)
* Monitors the CPU-temp and take actions if needed
* Can be installed an run as a Linux service
* Provided install-script for needed packages and settings etc
* WiFi management with 'commitup' from Dave Steel. 
* No writing to SD-card, all image handling in memory
* Tested with RPi 3B+ and Zero W but probably works for all raspberry pi models

## Planned features for the near future

* Video streaming to the local nework
* Configuration management from a web-site
* OTA update
* Support for more camera-types
* Support for an extra tempsensor inside the cam-box


## How to install and get started (the easy way)

Start with an sd-image with latest Raspberry Pi OS lite 32 bit (Legacy will NOT work). Use Raspberry Pi imager to pre-set WiFi and hostname etc and build an image for your pi-type.

When the WiFi is pre-set, you can directly start 'headless', ssh to target, copy the files and run the tools/install.py script which will update the os and then install all needed packages and services. After a reboot you need to set up the network again, using the comitup captive portal.

## Contibuting




## WIFI management with Comitup
The wifi is handled by the awesome software 'commitup' from Dave Steel. If the wifi doesn't find a known connection it starts an access-point and make it possible to define a new wifi-connection in a web-interface. 

https://github.com/davesteele/comitup/wiki/Installing-Comitup

## How it works
The basic function is to take pictures and send those to a backend.

There is a settings-file (camsettings.py) with a lot of different settings such as resolution, image-interval, backend-receive-script-url, loglevel etc. This file contains both the hardware settings and the default userconfig,


## Design-principles

A game-loop like structure based on states with different implementations.

A camera-object provides an image-array each round and depending on the currently active state the bussiness-logic take different shapes.

TBD: design-images, flows and classes etc...



## Examples of products using this software

### A cam for the inside of a bee-hive

A raspberry pi 3B+ using a picam3 with a 'wide-lens' and auto-focus. The software controls a lightbox and a status-led.

### A cam for the outside/entrance of a bee-hive

A raspberry pi Zero W using a picam3 with a 'std-lens' and auto-focus i a waterproof box. The software controls a status-led on the backside.

### A cam for arbitrary use, such as documenting insects visiting flowers

A Raspberry pi 3B+ using a picam3HQ camera.